<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moo‚Äëmunity Vote Battle</title>
  <style>
    :root{
      --bg1:#000; --bg2:#0b1220; --bg3:#1e1637; --card:#ffffff18; --border:#ffffff22;
      --text:#fff; --muted:#cbd5e1; --accent:#e879f9; --accent2:#22d3ee; --good:#34d399; --bad:#f87171;
    }
    html,body{height:100%;}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif; color:var(--text);
      background: radial-gradient(1200px 600px at 20% 10%, #2b1a50 0%, transparent 60%),
                  radial-gradient(1000px 500px at 90% 0%, #0a3a5a 0%, transparent 60%),
                  linear-gradient(140deg, var(--bg1), var(--bg2) 45%, var(--bg3));
      overflow-x:hidden;
    }
    .container{max-width:1100px; margin:0 auto; padding:16px; position:relative;}
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    .stats{display:flex; align-items:center; gap:10px;}
    .stat{background:var(--card); border:1px solid var(--border); padding:10px 12px; border-radius:14px;}
    .muted{color:var(--muted); font-size:12px}
    .title{font-weight:700; font-size:clamp(20px,3.6vw,28px)}
    .btn{background:var(--card); border:1px solid var(--border); color:var(--text); padding:8px 12px; border-radius:12px; cursor:pointer}
    .btn:hover{background:#ffffff26}
    .controls{display:flex; gap:8px; align-items:center}
    .grid{display:grid; grid-template-columns:1fr; gap:16px}
    @media (min-width:800px){ .grid{grid-template-columns:1fr 1fr} }
    .card{position:relative; overflow:hidden; border-radius:18px; padding:16px; border:1px solid var(--border); box-shadow:0 10px 30px #0004}
    .grad1{background: linear-gradient(135deg, #db37c8, #5b2ea2);} 
    .grad2{background: linear-gradient(135deg, #1cb8d8, #2652db);} 
    .glass{position:absolute; inset:0; background:#0006}
    .cowHead{font-size:36px; filter:drop-shadow(0 2px 4px #0008)}
    .speech{display:inline-flex; align-items:flex-start; gap:8px; background:#fffE; color:#0f172a; padding:10px 12px; border-radius:16px; box-shadow:0 10px 22px #0005}
    .badge{position:absolute; top:10px; right:10px; font-size:11px; padding:6px 10px; border-radius:999px; font-weight:700}
    .badge.win{background:#a7f3d0; color:#064e3b}
    .badge.pick{background:#ffffff55; color:#fff}

    /* Slim global progress */
    .barWrap{height:8px; background:#ffffff22; border-radius:999px; overflow:hidden}
    .bar{height:100%; background: linear-gradient(90deg, var(--accent), #a78bfa); width:0%}

    /* Ring timer */
    .ring{height:48px; width:48px; transform:rotate(-90deg)}
    .ring circle.bg{stroke: #ffffff33; fill:none; stroke-width:2}
    .ring circle.fg{stroke: #fff; fill:none; stroke-width:2; stroke-dasharray:0 100}

    /* Farm background */
    .farm{position:fixed; inset:0; z-index:-1; pointer-events:none}
    .grass{position:absolute; inset:0; background:linear-gradient(to bottom, #06200f88, #06200faa), repeating-linear-gradient(0deg, #15803d33 0px, #15803d33 2px, #16a34a33 3px)}
    .fence{position:absolute; left:0; right:0; bottom:64px; height:10px; opacity:.25; background: repeating-linear-gradient(90deg, transparent 0 60px, #fff 60px 64px) }
    .cow{position:absolute; font-size:28px; opacity:.9; filter:drop-shadow(0 2px 2px #0008)}

    /* Game over modal */
    .center{min-height:100svh; display:flex; align-items:center; justify-content:center}
    .panel{background: #120c1f99; border:1px solid var(--border); backdrop-filter: blur(6px); border-radius:16px; padding:22px; text-align:center}

    .footer{display:grid; grid-template-columns:1fr; gap:12px; margin-top:16px}
    @media (min-width:900px){ .footer{grid-template-columns:repeat(3,1fr)} }

    .logo{height:48px; width:48px; border-radius:14px; overflow:hidden; background:#fff; display:grid; place-items:center; box-shadow:0 8px 18px #0007}
    .logo img{max-width:100%; max-height:100%}

    .pill{display:inline-block; font-size:12px; padding:6px 10px; background:#00000050; border:1px solid var(--border); border-radius:999px}
  </style>
</head>
<body>
  <!-- Farm background -->
  <div class="farm" id="farm">
    <div class="grass"></div>
    <div class="fence"></div>
    <!-- cows injected by JS -->
  </div>

  <div class="container">
    <!-- Global progress & time -->
    <div class="barWrap" aria-label="3-minute progress" role="progressbar" aria-valuemin="0" aria-valuemax="100">
      <div class="bar" id="globalBar"></div>
    </div>
    <div class="muted" style="margin-top:6px">Time left: <span id="globalTime">3:00</span></div>

    <div class="row" style="margin:14px 0 18px 0">
      <div class="row" style="gap:12px">
        <div class="logo"><img src="./6f7d8861-dddd-4dcf-8dfe-7a856034e284.png" alt="Common" onerror="this.style.display='none'"/></div>
        <div>
          <div class="title">Moo‚Äëmunity Vote Battle</div>
          <div class="muted">Earn as many points as you can in 3 minutes!</div>
        </div>
      </div>
      <div class="controls">
        <div class="stat"><div class="muted">Score</div><div id="score" style="font-weight:700">0</div></div>
        <div class="stat"><div class="muted">Streak</div><div id="streak" style="font-weight:700">0üî•</div></div>
        <button class="btn" id="muteBtn" title="Mute">üîá</button>
        <button class="btn" id="pauseBtn" title="Pause">‚è∏</button>
        <button class="btn" id="resetBtn" title="Reset">‚Ü∫</button>
      </div>
    </div>

    <div class="row" style="gap:14px; margin-bottom:12px">
      <svg class="ring" viewBox="0 0 36 36" aria-hidden="true">
        <circle class="bg" cx="18" cy="18" r="15.9155"></circle>
        <circle class="fg" id="ringFg" cx="18" cy="18" r="15.9155" stroke-dasharray="0 100"></circle>
      </svg>
      <div class="muted"><strong id="roundTime">10</strong>s ‚Ä¢ <span class="muted" id="roundLabel">Round 1</span></div>
      <div class="pill">Pick an idea before the per‚Äëround timer ends! (1 / 2 keys work)</div>
      <div class="logo"><img src="./760deb62-2449-4025-9a74-e3c68a04a286.png" alt="Lamumu" onerror="this.style.display='none'"/></div>
    </div>

    <div class="grid" id="grid">
      <!-- Two choice cards injected by JS -->
    </div>

    <div class="footer">
      <div class="stat">
        <div class="muted">Round Result</div>
        <div id="result">Pick a side before the timer ends.</div>
      </div>
      <div class="stat">
        <div class="muted">How scoring works</div>
        <div>Match the community pick to earn <strong>100 √ó multiplier</strong>. Every 3 wins in a row increases your multiplier.</div>
      </div>
      <div class="stat">
        <div class="muted">Branding</div>
        <div>Uses Common (header) and Lamumu (card) logos. If logos don‚Äôt show, ensure both PNGs are in <code>public/</code>.</div>
      </div>
    </div>
  </div>

  <div id="modal" class="center" style="display:none">
    <div class="panel">
      <h2 style="margin:0 0 6px 0">Game Over</h2>
      <div style="margin-bottom:14px">You scored <strong id="finalScore">0</strong> points in 3 minutes!</div>
      <div style="display:flex; gap:10px; justify-content:center">
        <button class="btn" id="againBtn">Play Again</button>
        <button class="btn" id="shareBtn">Share on X</button>
      </div>
    </div>
  </div>

  <script>
  // ======= Data =======
  const IDEAS = [
    "Launch tokens fast",
    "Reward early believers",
    "Community-owned treasuries",
    "On-chain votes = voice",
    "Creator quests & bounties",
    "Fair airdrop criteria",
    "Meme to momentum",
    "NFTs as access keys",
    "Open, composable tools",
    "Shared upside for contributors",
    "Transparent proposals",
    "Low-friction governance",
    "Ship > Hype",
    "One-click token launch",
    "Bridge art + utility",
    "Community leaderboards",
    "Build in public",
    "Permissionless experiments",
    "Fan-powered funding",
    "Keep it fun, keep it fair",
  ];

  const ROUND_SECONDS = 10;
  const GAME_SECONDS = 180; // 3 minutes
  const MAX_COWS = 24;

  const $ = (sel)=>document.querySelector(sel);
  const grid = $('#grid');
  const resultEl = $('#result');
  const scoreEl = $('#score');
  const streakEl = $('#streak');
  const roundLabel = $('#roundLabel');
  const roundTime = $('#roundTime');
  const ringFg = $('#ringFg');
  const globalBar = $('#globalBar');
  const globalTime = $('#globalTime');
  const modal = $('#modal');
  const finalScoreEl = $('#finalScore');

  // audio (tiny WebAudio beeps)
  let audioCtx;
  const makeBeep = (freq=440, dur=0.09, vol=0.02)=>{
    if (!audioCtx) return ()=>{};
    return ()=>{
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.connect(g); g.connect(audioCtx.destination);
      o.frequency.value = freq; g.gain.value = vol;
      o.start(); setTimeout(()=>{try{o.stop()}catch(e){}}, dur*1000);
    };
  };

  // state
  let round=1, score=0, streak=0, reveal=false, playerChoice=null, communityPick=0;
  let timeLeft=ROUND_SECONDS, gameLeft=GAME_SECONDS, paused=false, gameOver=false, cows=1;
  let tickRef=null, gameTickRef=null, muted=true;

  const clickS = ()=>{ if(!muted) clickBeep(); };
  let clickBeep, winBeep, loseBeep;

  function initAudio(){
    const Ctx = window.AudioContext||window.webkitAudioContext; if(!Ctx) return;
    audioCtx = new Ctx();
    clickBeep = makeBeep(540, .06, .02);
    winBeep = makeBeep(720, .12, .03);
    loseBeep = makeBeep(220, .12, .04);
  }

  // helpers
  const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
  const two=(n)=>String(n).padStart(2,'0');
  function pick2(arr){
    if(arr.length<2) return [arr[0]||'', arr[1]||''];
    const i=Math.floor(Math.random()*arr.length);
    let j=Math.floor(Math.random()*(arr.length-1)); if(j>=i) j++;
    return [arr[i], arr[j]];
  }

  function setRing(percent){ ringFg.setAttribute('stroke-dasharray', `${Math.max(0,percent)}, 100`); }
  function setGlobalBar(){
    const pct = Math.max(0, Math.min(1, 1 - gameLeft/GAME_SECONDS));
    globalBar.style.width = (pct*100).toFixed(2)+'%';
    globalTime.textContent = `${Math.floor(gameLeft/60)}:${two(gameLeft%60)}`;
  }

  function renderFarm(){
    const farm = document.getElementById('farm');
    // remove old cows
    [...farm.querySelectorAll('.cow')].forEach(n=>n.remove());
    // add cows
    for(let i=0;i<cows;i++){
      const d=document.createElement('div'); d.className='cow';
      const left = 5 + Math.random()*90; const top = 30 + Math.random()*60; const flip = Math.random()>.5;
      d.style.left=left+'%'; d.style.top=top+'%'; d.style.transform=`scaleX(${flip?-1:1})`;
      d.textContent = Math.random()>.5?'üêÑ':'üêÆ';
      farm.appendChild(d);
    }
  }

  function renderOptions(){
    grid.innerHTML='';
    const [a,b]=pick2(IDEAS);
    const opts=[a,b];
    communityPick = Math.random()<.5?0:1;

    opts.forEach((text,idx)=>{
      const card=document.createElement('button');
      card.className='card '+(idx? 'grad2':'grad1');
      card.onclick=()=>vote(idx);
      card.innerHTML=`
        <div class="glass"></div>
        <div class="row" style="gap:10px; position:relative; z-index:1">
          <div class="cowHead">${idx? 'üêÑ':'üêÆ'}</div>
          <div>
            <div class="muted" style="letter-spacing:.08em; text-transform:uppercase">${idx? 'Lamu #2':'Lamu #1'}</div>
            <div style="font-weight:800; font-size:20px">Lamumu</div>
          </div>
        </div>
        <div style="margin-top:12px; position:relative; z-index:1">
          <div class="speech">üí¨ <span style="font-weight:600; line-height:1.2">${text}</span></div>
        </div>
        <img alt="Lamumu" src="./760deb62-2449-4025-9a74-e3c68a04a286.png" onerror="this.style.display='none'" style="position:absolute; right:12px; bottom:12px; height:42px; width:42px; border-radius:999px; box-shadow:0 6px 12px #0007;"/>
        <div class="badge pick" id="pick-${idx}" style="display:none">Your Pick</div>
        <div class="badge win" id="win-${idx}" style="display:none">Community Pick</div>
      `;
      grid.appendChild(card);
    });
  }

  function startRound(){
    playerChoice=null; reveal=false; timeLeft=ROUND_SECONDS; setRing(100); renderOptions(); updateLabels();
    if(tickRef) clearInterval(tickRef);
    tickRef = setInterval(()=>{
      if(paused || gameOver) return;
      timeLeft--; roundTime.textContent=timeLeft; setRing((timeLeft/ROUND_SECONDS)*100);
      if(timeLeft<=0){ clearInterval(tickRef); reveal=true; showReveal(); setTimeout(()=>{ if(!gameOver) nextRound(); }, 1200); }
    },1000);
  }

  function showReveal(){
    // show badges
    const a=$(`#pick-0`), b=$(`#pick-1`), wa=$(`#win-0`), wb=$(`#win-1`);
    a.style.display = (playerChoice===0 && playerChoice!==null)?'inline-block':'none';
    b.style.display = (playerChoice===1 && playerChoice!==null)?'inline-block':'none';
    wa.style.display = (communityPick===0)?'inline-block':'none';
    wb.style.display = (communityPick===1)?'inline-block':'none';

    if(playerChoice===null){
      resultEl.textContent = '‚è≥ No vote this round. Streak stays.';
      // cows unchanged
      return;
    }

    if(playerChoice===communityPick){
      streak++; score += 100 * (1+Math.floor((streak-1)/3));
      resultEl.textContent = `‚úÖ You matched the community! +${100*(1+Math.floor((streak-1)/3))} points (√ó${1+Math.floor((streak-1)/3)})`;
      cows = clamp(cows+1, 0, MAX_COWS);
      if(!muted && winBeep) winBeep();
    } else {
      streak = 0; resultEl.textContent = '‚ùå Community disagreed. Streak reset.';
      cows = clamp(cows-1, 0, MAX_COWS);
      if(!muted && loseBeep) loseBeep();
    }
    scoreEl.textContent = score; streakEl.textContent = `${streak}üî•`;
    renderFarm();
  }

  function nextRound(){ round++; startRound(); }

  function updateLabels(){
    roundLabel.textContent = `Round ${round}`;
    roundTime.textContent = timeLeft;
  }

  function vote(idx){ if(reveal||gameOver) return; if(!audioCtx) initAudio(); if(!muted && clickBeep) clickBeep(); playerChoice=idx; reveal=true; showReveal(); setTimeout(()=>{ if(!gameOver) nextRound(); }, 1200); }

  function loopGameTimer(){
    if(gameTickRef) clearInterval(gameTickRef);
    gameTickRef = setInterval(()=>{
      if(paused || gameOver) return;
      gameLeft--; setGlobalBar();
      if(gameLeft<=0){ clearInterval(gameTickRef); endGame(); }
    },1000);
  }

  function endGame(){
    gameOver=true; modal.style.display='flex'; finalScoreEl.textContent = score;
  }

  // buttons
  $('#muteBtn').onclick=()=>{ muted=!muted; $('#muteBtn').textContent = muted?'üîá':'üîä'; if(!audioCtx) initAudio(); };
  $('#pauseBtn').onclick=()=>{ paused=!paused; $('#pauseBtn').textContent = paused?'‚ñ∂Ô∏è':'‚è∏'; };
  $('#resetBtn').onclick=()=>{ resetGame(); };
  $('#againBtn').onclick=()=>{ resetGame(); modal.style.display='none'; };
  $('#shareBtn').onclick=()=>{
    const msg = `üêÆ Just scored ${score} points in Moo-munity Vote Battle! ‚ö° Built with @commondotxyz √ó @lamumudotxyz | Game by @DaUnknown_eth ‚Äî join the movement!`;
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(msg)}`;
    window.open(url, '_blank');
  };

  // keyboard
  window.addEventListener('keydown', (e)=>{
    if(e.key==='1') vote(0);
    if(e.key==='2') vote(1);
  });

  function resetGame(){
    round=1; score=0; streak=0; reveal=false; playerChoice=null; communityPick=0; timeLeft=ROUND_SECONDS; gameLeft=GAME_SECONDS; paused=false; gameOver=false; cows=1;
    scoreEl.textContent='0'; streakEl.textContent='0üî•'; setGlobalBar(); renderFarm(); startRound();
  }

  // init
  setGlobalBar(); renderFarm(); startRound(); loopGameTimer();
  </script>
</body>
</html>
